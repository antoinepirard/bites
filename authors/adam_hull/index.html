<!DOCTYPE html><html class="no-js" lang="en"><head><meta charset="utf-8" /><title>Adam Hull | Bites from Good Eggs</title><meta name="author" content="Adam Hull" /><meta name="viewport" content="width=device-width, initial-scale=1" /><link rel="shortcut icon" href="../../favicon.ico?v=2" /><link rel="stylesheet" href="../../styles/main.css" /><link rel="alternate" title="RSS" type="application/rss+xml" href="../../rss" /><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-26193287-5', 'github.io');
ga('send', 'pageview');</script></head><body><header><h1><a href="../../">Bites</a></h1><ul class="unstyled nav"><li><a href="../../">Blog</a></li><li><a href="../../open_source">Open Source</a></li><li><a href="../../news">News</a></li></ul></header><div id="main"><div id="content"><div><section class="profile"><div class="meta"><img src="http://fpio.goodeggs.com/api/file/ziGF1yRt2PAZq3BpMQAA/convert?w=150&amp;h=150&amp;fit=crop&amp;align=faces&amp;cache=true" /></div><div class="content"><p>People working with food because they want to are unusually nice. I like spending time with them. So I make software for Good Eggs. Some day I&#39;ll step away from the screen long enough to build a mixed residential &amp; commercial multi-tenant owner-occupied urban building. The ground floor will have a café with pastries and coffee sourced from Good Eggs. The veggies will come from a combo treehouse / farm / summer home not too many miles away. Until then, I&#39;ll climb rocks.</p>
<div class="author">- Adam</div></div></section></div><div class="blog-index"><article><header><h1 class="entry-title"><a href="../../posts/speed-up-your-responsive-app-with-node-and-varnish/">Speed up your responsive app with Node and Varnish</a></h1><p class="meta"><a href="../../authors/adam_hull/">Adam Hull</a> on <time datetime="2014-09-29T00:00:00.000Z">September 29th, 2014</time></p></header><div class="entry-content"><div class="series">
    <blockquote>This is the fourth article in a series of posts detailing the launch of our mobile site.</blockquote>
    <ol>
        <li><a href="../../posts/good-eggs-goes-mobile">Good Eggs Goes Mobile</a></li>
        <li><a href="../../posts/rivets-for-mobile">Rivets for Mobile Web</a></li>
        <li><a href="../../posts/mobile-page-load">Planning Page Load Sequence</a></li>
        <li><a href="../../posts/speed-up-your-responsive-app-with-node-and-varnish">Speed with Node and Varnish</a></li>
        <li>Appropriate image sizes with imgix</li>
        <li>Integration testing over unit testing</li>
    </ol>
</div>

<p>Conversations about responsive design often focus on the browser: media queries, grids, and the like, but there&#39;s more!  Creating a great experience on all sorts of consumer-grade doo-dads demands some work on the server.</p>
<p>On Good Eggs, shoppers with full-sized computers don&#39;t want all their grocery aisles hidden behind a collapsible menu. The markup to generate the desktop navigation is different enough from the mobile navigation that using media queries would be a stretch (heh, get it?).  By trimming the more complicated desktop markup from the mobile response, we save precious page weight for a faster load time.</p>
<p>Let&#39;s take a journey along the request-response cycle to illustrate how we send different responses to different devices while maximizing cache hits:</p>
<p><img src="../../images/posts/server-side-responsive-express-varnish/flow.jpg" alt="Flow Diagram">
</div><footer><a rel="full-article" href="../../posts/speed-up-your-responsive-app-with-node-and-varnish/">Continue…</a></footer></article><article><header><h1 class="entry-title"><a href="../../posts/mobile-page-load/">Loading Scripts in the Critical Path: A Commerce Case Study</a></h1><p class="meta"><a href="../../authors/adam_hull/">Adam Hull</a> on <time datetime="2014-06-16T00:00:00.000Z">June 16th, 2014</time></p></header><div class="entry-content"><div class="series">
    <blockquote>This is the third article in a series of posts detailing the launch of our mobile site.</blockquote>
    <ol>
        <li><a href="../../posts/good-eggs-goes-mobile">Good Eggs Goes Mobile</a></li>
        <li><a href="../../posts/rivets-for-mobile">Rivets for Mobile Web</a></li>
        <li><a href="../../posts/mobile-page-load">Planning Page Load Sequence</a></li>
        <li><a href="../../posts/speed-up-your-responsive-app-with-node-and-varnish">Speed with Node and Varnish</a></li>
        <li>Appropriate image sizes with imgix</li>
        <li>Integration testing over unit testing</li>
    </ol>
</div>

<p>Starting javascript on DOMContentLoaded, a pattern <a href="https://docs.angularjs.org/guide/bootstrap">baked into</a> or <a href="http://backbonejs.org/docs/todos.html#section-2">recommended by</a> many frameworks, defers some work that could be done earlier.  There aren&#39;t many examples of what can be done early, or how to wire it up.  Here&#39;s how we did it on the Good Eggs mobile site.
</div><footer><a rel="full-article" href="../../posts/mobile-page-load/">Continue…</a></footer></article><article><header><h1 class="entry-title"><a href="../../posts/rivets-for-mobile/">Rivets for Mobile Web</a></h1><p class="meta"><a href="../../authors/adam_hull/">Adam Hull</a> on <time datetime="2014-04-25T00:00:00.000Z">April 25th, 2014</time></p></header><div class="entry-content"><div class="series">
    <blockquote>This is the second article in a series of posts detailing the launch of our mobile site.</blockquote>
    <ol>
        <li><a href="../../posts/good-eggs-goes-mobile">Good Eggs Goes Mobile</a></li>
        <li><a href="../../posts/rivets-for-mobile">Rivets for Mobile Web</a></li>
        <li><a href="../../posts/mobile-page-load">Planning Page Load Sequence</a></li>
        <li><a href="../../posts/speed-up-your-responsive-app-with-node-and-varnish">Speed with Node and Varnish</a></li>
        <li>Appropriate image sizes with imgix</li>
        <li>Integration testing over unit testing</li>
    </ol>
</div>

<p>Before coding a phone-sized farmer&#39;s market, the Good Eggs team built
production sites using tools at both extremes of the javascript application
ecosystem:  Backbone for our desktop experience and Angular for our internal tools.
But neither felt quite right for our mobile site.</p>
<p>We had two priorities for our mobile toolchain: </div><footer><a rel="full-article" href="../../posts/rivets-for-mobile/">Continue…</a></footer></article><article><header><h1 class="entry-title"><a href="../../posts/fibrous-on-harmony-generators/">Fibrous on Harmony Generators? Impossible</a></h1><p class="meta"><a href="../../authors/adam_hull/">Adam Hull</a> on <time datetime="2013-08-17T00:00:00.000Z">August 17th, 2013</time></p></header><div class="entry-content"><p>A good Friday afternoon chat about asynchronous programming models left me wondering if the fibrous API could be implemented on top of <a href="http://wiki.ecmascript.org/doku.php?id=harmony:generators">ES6 generators</a>. Generators are baked in to Node 0.11, Chrome 19, and Firefox.  A port would be a big boost to interoperability.  <a href="https://github.com/google/traceur-compiler">Traceur</a> can even transform generator based code into a <a href="http://traceur-compiler.googlecode.com/git/demo/repl.html#function*%20test%20()%20%7B%0A%20%20yield%201%3B%0A%20%20var%20a%20%3D%20yield%202%3B%0A%20%20try%20%7B%0A%20%20%20%20yield%20a%3B%0A%20%20%7D%20catch%20(e)%20%7B%0A%20%20%20%20yield%2099%3B%0A%20%20%7D%0A%20%20for(var%20i%20%3D0%3B%20i%20%3C%201%3B%20i%2B%2B)%20%7B%0A%20%20%20%20yield%20123%3B%0A%20%20%7D%0A%7D%0A%0Afunction%20normal()%20%7B%0A%20%20var%20a%20%3D%20b%3B%0A%20%20return%20b%3B%0A%7D">giant state machine</a> that runs on all of today&#39;s environments.</p>
<p>At first the port looked promising. Wikipedia claimed that general coroutines could be <a href="http://en.wikipedia.org/wiki/Coroutine#Comparison_with_generators">built on generators</a>, and many folks have <a href="http://taskjs.org/">done</a> <a href="https://gist.github.com/creationix/5762837">just</a> <a href="https://gist.github.com/Benvie/5667557">that</a>.  After a little noodling I&#39;m pretty sure it can&#39;t be done.  In a Harmony environment a function can only suspend execution at <code>yield</code> expressions and <code>yield</code> expressions can only appear in generator functions. A yield expression cannot be wrapped up behind a fibrous <code>sync</code> or <code>wait</code>.</p>
</div><footer><a rel="full-article" href="../../posts/fibrous-on-harmony-generators/">Continue…</a></footer></article><article><header><h1 class="entry-title"><a href="../../posts/ids-in-mongoose-json-and-backbone/">Ids in Mongoose, JSON, and Backbone</a></h1><p class="meta"><a href="../../authors/adam_hull/">Adam Hull</a> on <time datetime="2013-04-02T00:00:00.000Z">April 2nd, 2013</time></p></header><div class="entry-content"><p>Mongoose adds <a href="http://mongoosejs.com/docs/guide.html#id">id sugar</a> on top the default _id document attribute.  Backbone has <a href="http://backbonejs.org/#Model-idAttribute">similar sugar</a>, but the types don&#39;t line up.  Pushing bits between the two with a customary JSON document adds a third representation.</p>
<p>If you find yourself typing <code>vegetable.id</code> when you really needed <code>new ObjectID(vegetable.toJSON()._id)</code> this fancy chart might help:
</div><footer><a rel="full-article" href="../../posts/ids-in-mongoose-json-and-backbone/">Continue…</a></footer></article><article><header><h1 class="entry-title"><a href="../../post/41935904836/restructuring-assignment-in-coffeescript">Structuring Expressions in CoffeeScript</a></h1><p class="meta"><a href="../../authors/adam_hull/">Adam Hull</a> on <time datetime="2013-02-12T00:00:00.000Z">February 12th, 2013</time></p></header><div class="entry-content"><p>CoffeeScript can save as many keystrokes putting objects together as it can taking them apart.</p>
<p class="update">
  For a while I was calling this lexeme <em>restructuring assignment</em> until some on Stack Overflow <a href="http://stackoverflow.com/a/14822198/407845">pointed out that name was ridiculous</a>.  Now I&#39;ve taken to the name <em>structuring expressions</em>.
</p>

</div><footer><a rel="full-article" href="../../post/41935904836/restructuring-assignment-in-coffeescript">Continue…</a></footer></article><article><header><h1 class="entry-title"><a href="../../post/40042760798/teacup-coffeescript-templates-for-developer-happiness">Teacup: CoffeeScript Templates for Developer Happiness</a></h1><p class="meta"><a href="../../authors/adam_hull/">Adam Hull</a> on <time datetime="2013-01-08T00:00:00.000Z">January 8th, 2013</time></p></header><div class="entry-content"><p><a href="http://goodeggs.github.com/teacup/"><img src="https://raw.github.com/goodeggs/teacup/master/docs/teacup.jpg" alt="Teacup"></a></p>
<p>We&#8217;ve released a <a href="http://goodeggs.github.com/teacup/">templating language</a> that feels just right for a team of full stack CoffeeScript developers optimizing for developer happiness.  Check out the <a href="http://goodeggs.github.com/teacup/#getting-started">example integrations</a> with Backbone, Express, and Rails, or try it neat in the browser.  Teacup builds on <a href="https://github.com/mark-hahn/drykup">a</a> <a href="https://github.com/markaby/markaby">rich</a> <a href="https://github.com/mauricemach/coffeekup">history</a> of templating in the language of your app to minimize context switching and toolchain duplication while trusting the developer to maintain separation between domain and templating tiers.  Here&#8217;s a quick sample:</p>
<pre class="highlight"><code class="coffeescript">{renderable, ul, li, input} = <span class="built_in">require</span> <span class="string">'teacup'</span>

template = renderable <span class="function"><span class="params">(teas)</span>-&gt;</span>
  ul<span class="function"> -&gt;</span>
    <span class="keyword">for</span> tea <span class="keyword">in</span> teas
      li tea
    input <span class="attribute">type</span>: <span class="string">'button'</span>, <span class="attribute">value</span>: <span class="string">'Steep'</span>

console.log template([<span class="string">'Jasmine'</span>, <span class="string">'Darjeeling'</span>])</code></pre>
<p>Outputs:</p>
<pre class="highlight"><code class="xml"><span class="tag">&lt;<span class="title">ul</span>&gt;</span>
  <span class="tag">&lt;<span class="title">li</span>&gt;</span>Jasmine<span class="tag">&lt;/<span class="title">li</span>&gt;</span>
  <span class="tag">&lt;<span class="title">li</span>&gt;</span>Darjeeling<span class="tag">&lt;/<span class="title">li</span>&gt;</span>
<span class="tag">&lt;/<span class="title">ul</span>&gt;</span>
<span class="tag">&lt;<span class="title">input</span> <span class="attribute">type</span>=<span class="value">"button"</span> <span class="attribute">value</span>=<span class="value">"Steep"</span>/&gt;</span></code></pre>
<p>Try it out!</p>
</div></article><article><header><h1 class="entry-title"><a href="../../post/36553128854/how-to-remove-a-property-from-a-mongoosejs-schema">How to Remove a Property from a Mongoose.js Schema</a></h1><p class="meta"><a href="../../authors/adam_hull/">Adam Hull</a> on <time datetime="2012-11-03T00:00:00.000Z">November 3rd, 2012</time></p></header><div class="entry-content"><p>This should be simple, but Mongoose really clings to data in existing documents.  I&#39;ll walk through all the ways I wanted it to work that failed.  We&#39;ll remove an <code>organic</code> flag from a toy <code>Food</code> model so we can replace it with <a href="http://www.nytimes.com/2012/10/14/opinion/sunday/bittman-my-dream-food-label.html">Bittman&#39;s dream label</a>.  If you just came for the answer, I arrived at:</p>
<pre class="highlight"><code class="javascript">Food.collection.update({},
  {$unset: {organic: <span class="literal">true</span>}},
  {multi: <span class="literal">true</span>, safe: <span class="literal">true</span>}
);</code></pre>
<p></div><footer><a rel="full-article" href="../../post/36553128854/how-to-remove-a-property-from-a-mongoosejs-schema">Continue…</a></footer></article></div></div></div><footer><div class="mission">Our mission is to grow and sustain local food systems worldwide.</div><p>©2013 Good Eggs, Inc</p></footer></body></html>