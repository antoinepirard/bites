<!DOCTYPE html><html class="no-js" lang="en"><head><meta charset="utf-8" /><title>Synchronous node console with fibrous | Bites from Good Eggs</title><meta name="author" content="Alon Salant" /><meta name="viewport" content="width=device-width, initial-scale=1" /><link rel="shortcut icon" href="/favicon.ico?v=2" /><link rel="stylesheet" href="/styles/main.css" /><link rel="alternate" title="RSS" type="application/rss+xml" href="/rss" /><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-26193287-5', 'github.io');
ga('send', 'pageview');</script></head><body><header><h1><a href="/">Bites</a></h1><ul class="unstyled nav"><li><a href="/">Blog</a></li><li><a href="/open_source/">Open Source</a></li><li><a href="/news/">News</a></li></ul></header><div id="main"><div id="content"><div><article class="post" role="article"><header><img class="author" src="https://goodeggs2.imgix.net/user_profile_photo/XyyXQtPpS6yeWbBMCMXj_alon_salant.jpg?w=150&amp;h=150&amp;q=&amp;fit=crop&amp;crop=faces" alt="Alon Salant" /><h1 class="entry-title">Synchronous node console with fibrous</h1><p class="meta"><a class="entry-author-name" href="/authors/alon_salant/">Alon Salant</a> on <time datetime="2012-11-18T20:00:00.000Z">November 18th, 2012</time></p></header><div class="entry-content"><p>Node’s interactive console, or <a href="http://nodejs.org/api/repl.html">REPL</a> (Read-Eval-Print-Loop), is handy for debugging and interacting directly with our applications. The one bummer is that it’s awkward to make asynchronous calls in the console especially when they need to be nested and writing them requires multiple lines for any hope of readability.</p>
<p><a href="https://github.com/goodeggs/fibrous">fibrous</a> simplifies async coding with Node and can help us out with the REPL too.
<!-- more --></p>
<pre><code class="js"><span class="hljs-comment">// fibrous_repl.js</span>
<span class="hljs-keyword">var</span> vm = <span class="hljs-built_in">require</span>(<span class="hljs-string">'vm'</span>);
<span class="hljs-keyword">var</span> repl = <span class="hljs-built_in">require</span>(<span class="hljs-string">'repl'</span>);
<span class="hljs-keyword">var</span> fibrous = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fibrous'</span>);

<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Starting fibrous REPL..."</span>);
repl.start({
  <span class="hljs-built_in">eval</span>: fibrous(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(code, context, file)</span> </span>{
    <span class="hljs-keyword">return</span> vm.runInContext(code, context, file);
  })
});</code></pre>

<p>Running this file with <code>node fibrous_repl.js</code> starts an interactive console with every command running in a fiber so that we can use <code>sync</code> and <code>wait</code> as we please.</p>
<pre><code>$ node fibrous_repl.js
Starting fibrous REPL...
&gt; var fs = require(&#39;fs&#39;);
undefined
&gt; data = fs.sync.readFile(&#39;/etc/passwd&#39;, &#39;utf-8&#39;);
...
&gt; console.log(data);
##
# User Database
#
...
</code></pre><p>We use the console a lot to poke at our apps, inspect live state and change data on the fly. Using fibrous as shown above makes it super easy.</p>
</div><footer><p class="meta"><a class="basic-alignment left" href="/posts/reconnecting-to-mongodb-when-mongoose-connect-fails-at-startup/">&laquo; Reconnecting to MongoDB when Mongoose connect fails at startup</a><a class="basic-alignment right" href="/posts/synchronize-ajax-calls-for-backbone-models-and-collections/">Synchronize AJAX calls for Backbone Models and Collections &raquo;</a></p><div id="disqus_thread"></div><script>window.disqus_shortname = 'goodeggsbytes'; window.disqus_url = 'http://bytes.goodeggs.com/post/36053394113/synchronous-node-console-with-fibrous'</script><script async="async" src="//goodeggsbytes.disqus.com/embed.js"></script></footer></article></div></div></div><footer><div class="mission">Our mission is to grow and sustain local food systems worldwide.</div><p>©2013 Good Eggs, Inc</p></footer></body></html>